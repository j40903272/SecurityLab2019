# 延伸筆記1 - PSAD - port scan attack detector
---
The Port Scan Attack Detector psad is a lightweight system daemon written in is designed to work with Linux iptables/ip6tables/firewalld firewalling code to detect suspicious traffic such as port scans and sweeps, backdoors, botnet command and control communications, and more. It features a set of highly configurable danger thresholds (with sensible defaults provided), verbose alert messages that include the source, destination, scanned port range, begin and end times, TCP flags and corresponding nmap options, reverse DNS info, email and syslog alerting, automatic blocking of offending IP addresses via dynamic configuration of iptables rulesets, passive operating system fingerprinting, and DShield reporting.

In addition, psad incorporates many of the TCP, UDP, and ICMP signatures included in the Snort intrusion detection system. to detect highly suspect scans for various backdoor programs (e.g. EvilFTP, GirlFriend, SubSeven), DDoS tools (Mstream, Shaft), and advanced port scans (SYN, FIN, XMAS) which are easily leveraged against a machine via nmap. psad can also alert on Snort signatures that are logged via fwsnort, which makes use of the iptables string match extension to detect traffic that matches application layer signatures. As of the 2.4.4 release, psad can also detect the IoT default credentials scanning phase of the Mirai botnet.

### Features
* Detection for TCP SYN, FIN, NULL, and XMAS scans as well as UDP scans.
* Support for both IPv4 and IPv6 logs generated by iptables and ip6tables respectively.
* Detection of many signature rules from the Snort intrusion detection system.
* Forensics mode iptables/ip6tables logfile analysis (useful as a forensics tool for extracting scan information from old * iptables/ip6tables logfiles).
* Passive operating system fingerprinting via TCP syn packets. Two different fingerprinting strategies are supported; a re-implementation of p0f that strictly uses iptables/ip6tables log messages (requires the –log-tcp-options command line switch), and a TOS-based strategy.
* Email alerts that contain TCP/UDP/ICMP scan characteristics, reverse dns and whois information, snort rule matches, remote OS guess information, and more.
* When combined with fwsnort and the iptables string match extension, psad can generate alerts for application layer buffer overflow attacks, suspicious application commands, and other suspect layer 7 traffic.
* Icmp type and code header field validation.
* Configurable scan thresholds and danger level assignments.
* Iptables ruleset parsing to verify “default drop” policy stance.
* IP/network danger level auto-assignment (can be used to ignore or automatically escalate danger levels for certain networks).
* DShield alerts.
* Auto-blocking of scanning IP addresses via iptables/ip6tables and/or tcpwrappers based on scan danger level. (This feature is NOT enabled by default.)
* Parsing of iptables/ip6tables log messages and generation of CSV output that can be used as input to AfterGlow. This allows iptables/ip6tables logs to be visualized. Gnuplot is also supported.
* Status mode that displays a summary of current scan information with associated packet counts, iptables/ip6tables chains, and danger levels.

---
## 實際測試
#### Install
`sudo apt install psad
sudo systemctl status psad`
![ALT text](https://www.csie.ntu.edu.tw/~b04902103/psad_status.png)


#### Usage
* 開起 iptables logging 功能

`iptables -A INPUT -j LOG`

* 使用psad 分析 iptables log

`psad -A -m <iptables logfile>`

* 使用nmap對裝有psad的機器做掃描

`nmap -A [target machine]`

* results
![ALT text](https://www.csie.ntu.edu.tw/~b04902103/psad_result1.png)
![ALT text](https://www.csie.ntu.edu.tw/~b04902103/psad_result2.png)

---
### 使用心得
psad 功能非常多是個很強大實用的工具，安裝也非常簡單，但如果沒有好好設定iptables，也無法有效做分析，並且我在實際使用的時候psad分析需要一小段時間，如果封包流量很大的時候不知到能不能及時的運作。